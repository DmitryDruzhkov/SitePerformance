<div class="game-container">
  <div *ngIf="!gameStarted && !gameOver" class="start-info">
    <h1>–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –∑–∞–≥—Ä—É–∑–∫—É —Å–∞–π—Ç–∞</h1>
    <div class="player-info">
      <p class="input-info">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ email:</p>
      <input [(ngModel)]="playerName" required placeholder="–§–ò–û" />

      <input
        [(ngModel)]="playerEmail"
        required
        placeholder="Email"
        type="email"
      />

      <input
        [(ngModel)]="playerPhone"
        required
        placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"
        type="tel"
        placeholder="8-987-654-3210"
        pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
      />

      <input [(ngModel)]="playerPosition" required placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å" />

      <div class="privacy">
        <mat-radio-group
          [(ngModel)]="playerPersonalAgreement"
          aria-label="Select an option"
        >
          <mat-radio-button (click)="toggleAgreement()" [value]="true"
            >C–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</mat-radio-button
          >
        </mat-radio-group>
        <a href="https://lenta.com/i/pokupatelyam/privacy-policy/"
          >–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a
        >
      </div>

      <div class="start-button">
        <button
          class="start"
          (click)="startGame()"
          [disabled]="
            !playerName || !playerEmail || !playerPhone || !playerPosition
          "
        >
          –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        </button>
      </div>

      <div class="leaderboard" *ngIf="leaderboard.length">
        <p class="leaderboard-info">–¢–æ–ø 10</p>
        <table class="leaderboard-table">
          <thead>
            <tr>
              <th>#</th>
              <th>–ò–≥—Ä–æ–∫</th>
              <th>–û—á–∫–∏</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let player of leaderboard; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ player.name }}</td>
              <td>{{ player.score | number }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="gameStarted" class="game-content">
    <div class="metrics">
      <div class="metrics-timers">
        <div class="circle-group progress">
          <div class="circle-item" *ngFor="let metric of circleMetrics">
            <div class="radial-progress">
              <span class="radial-progress__percent">{{ metric.value }}</span>
              <svg class="radial-progress__svg" viewBox="0 0 36 36">
                <circle
                  class="radial-progress__background"
                  cx="18"
                  cy="18"
                  r="15.9155"
                ></circle>
                <circle
                  class="radial-progress__fill"
                  [attr.stroke-dasharray]="'100, 100'"
                  [attr.stroke-dashoffset]="100 - metric.fill / 3.6"
                  [style.color]="metric.color"
                  cx="18"
                  cy="18"
                  r="15.9155"
                ></circle>
              </svg>
            </div>
          </div>
        </div>

        <div class="metrics-timer">
          {{ timerString() }}
        </div>
      </div>
      <div class="progress-group">
        <div class="progress-group-back">
          <div [style.right]="progress()" class="progress-group-bar"></div>
        </div>
        <div [style.right]="progressImg()" class="progress-group-img">
          <img src="assets/uh_bike.svg" />
        </div>
      </div>
    </div>

    <div *ngIf="hint">{{ hint }}</div>

    <!-- <h2 class="site-visuals-title">–ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–∞–π—Ç–∞</h2> -->

    <div class="site-visuals-container">
      <img
        [@siteLoad]
        [src]="'assets/site-' + stage + '.png'"
        class="site-image"
        alt="Website stage"
      />

      <div class="vitals-box">
        <div class="vitals-box-title">–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ Web Vitals</div>
        <div class="vitals">
          <div class="vitals-item">
            <div class="vitals-container">
              <div class="vitals-red"></div>
              <div class="vitals-orange"></div>
              <div class="vitals-green"></div>
              <div
                class="vitals-indicator"
                [style.right.px]="calculateVitalPosition('fcp')"
              ></div>
            </div>
            <div class="vitals-label">FCP</div>
          </div>
          <div class="vitals-item">
            <div class="vitals-container">
              <div class="vitals-red"></div>
              <div class="vitals-orange"></div>
              <div class="vitals-green"></div>
              <div
                class="vitals-indicator"
                [style.right.px]="calculateVitalPosition('inp')"
              ></div>
            </div>
            <div class="vitals-label">INP</div>
          </div>
          <div class="vitals-item">
            <div class="vitals-container">
              <div class="vitals-red"></div>
              <div class="vitals-orange"></div>
              <div class="vitals-green"></div>
              <div
                class="vitals-indicator"
                [style.right.px]="calculateVitalPosition('lcp')"
              ></div>
            </div>
            <div class="vitals-label">LCP</div>
          </div>
          <div class="vitals-item">
            <div class="vitals-container">
              <div class="vitals-red"></div>
              <div class="vitals-orange"></div>
              <div class="vitals-green"></div>
              <div
                class="vitals-indicator"
                [style.right.px]="calculateVitalPosition('ttfb')"
              ></div>
            </div>
            <div class="vitals-label">TTFB</div>
          </div>
        </div>
      </div>
    </div>

    <div class="categories-container">
      <div class="category-column" *ngFor="let category of categories">
        <div class="category-title">{{ category }}</div>
        <button
          *ngFor="let imp of improvementsByCategory[category]"
          [matTooltip]="imp.description"
          matTooltipPosition="above"
          class="improvement-item"
          [class.applied]="imp.applied"
          [class.unaffordable]="!canApply(imp) && !imp.applied"
          (click)="tryApplyAction(imp)"
          [disabled]="imp.applied || !canApply(imp)"
        >
          <div class="improvement-title">{{ imp.name }}</div>
          <div class="improvement-details">
            <div class="improvement-details-item improvement-details-time">
              {{ imp.timeDays }} –¥–Ω
            </div>
            <div class="improvement-details-item improvement-details-price">
              {{ imp.costRub | number }} ‚ÇΩ
            </div>
            <!-- <div class="improvement-details-item improvement-details-price">
                  –≠—Ñ—Ñ–µ–∫—Ç: -{{ imp.effectMs }} –º—Å
                </div> -->
          </div>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="gameOver" class="end-block">
    <h1 *ngIf="gameWon">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –°–∞–π—Ç —Å—Ç–∞–ª —Å—É–ø–µ—Ä–±—ã—Å—Ç—Ä—ã–º! üöÄ</h1>
    <h1 *ngIf="!gameWon">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</h1>

    <div class="circle-group">
      <div class="circle-item" *ngFor="let metric of circleMetrics">
        <div class="radial-progress">
          <span class="radial-progress__percent">{{ metric.value }}</span>
          <svg class="radial-progress__svg" viewBox="0 0 36 36">
            <circle
              class="radial-progress__background"
              cx="18"
              cy="18"
              r="15.9155"
            ></circle>
            <circle
              class="radial-progress__fill"
              [attr.stroke-dasharray]="'100, 100'"
              [attr.stroke-dashoffset]="100 - metric.fill / 3.6"
              [style.color]="metric.color"
              cx="18"
              cy="18"
              r="15.9155"
            ></circle>
          </svg>
        </div>
        <div class="circle-label">{{ metric.label }}</div>
      </div>
    </div>

    <h2>–í–∞—à —Å—á—ë—Ç {{ playerScore }}</h2>

    <button class="start" (click)="reset()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  </div>
</div>
<button class="export" (click)="exportResults()">–≠–∫—Å–ø–æ—Ä—Ç</button>
